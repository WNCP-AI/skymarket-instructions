---
Title: SkyMarket Developer Track Tech Stack
tags: 
  - WNCP_AI
  - ID-Ventures
  - hackathon
  - developer
  - cursor
  - convex
  - stripe
  - mapbox
created: 2025-09-01
Description: Technical specification for the Developer Track (90 minutes) advanced SkyMarket implementation using Cursor IDE, Convex backend, Stripe payments, and Mapbox.
MOC:
  - "[[WNCP_AI MOC]]"
  - "[[ID Ventures MOC]]"
---

# SkyMarket Developer Track Tech Stack

## Executive Summary
The Developer Track builds a **production-ready marketplace** in **90 minutes** using Cursor IDE's AI-powered coding assistance with Convex backend. This implementation includes payment processing through Stripe, interactive maps via Mapbox, and real-time features, serving as the foundation for Expert Track enhancements.

## Architecture Overview

### System Architecture
```
┌─────────────────────────────────────────────────────────────┐
│             Developer Track Architecture (90 min)           │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  Development Environment                                    │
│  ├── Cursor IDE (AI-powered coding)                        │
│  └── Next.js 14 App Router + TypeScript                    │
│                                                             │
│  Frontend Layer                                            │
│  ├── React 18 Server Components                            │
│  ├── TypeScript 5 (strict mode)                            │
│  ├── Tailwind CSS + shadcn/ui                              │
│  └── Mapbox GL JS (interactive maps)                       │
│                                                             │
│  Backend Platform (Convex)                                 │
│  ├── Document Database (ACID compliant)                    │
│  ├── TypeScript Functions (auto-scaling)                   │
│  ├── Real-time Subscriptions (WebSocket)                   │
│  ├── Built-in Auth (email/OAuth)                           │
│  └── File Storage (media handling)                         │
│                                                             │
│  Third-Party Integrations                                  │
│  ├── Stripe (payment processing)                           │
│  ├── Mapbox (Detroit area maps)                            │
│  └── Resend (transactional email)                          │
│                                                             │
│  Deployment                                                │
│  └── Vercel + Convex Cloud                                 │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### What Will Be Built
- **Full-Stack Application**: Complete marketplace with backend and frontend
- **Payment System**: Stripe integration with secure checkout
- **Interactive Maps**: Visual service areas and real-time tracking
- **Real-time Features**: Live updates, instant messaging, order tracking

## Core Technology Stack

### Development Environment

#### Cursor IDE Setup
```json
{
  "cursor": {
    "ai_model": "gpt-4",
    "features": {
      "copilot": true,
      "chat": true,
      "cmd_k": true,
      "auto_complete": true
    }
  }
}
```

### Frontend Framework

#### Next.js 14 Configuration
```typescript
// next.config.js
/** @type {import('next').NextConfig} */
const nextConfig = {
  experimental: {
    serverActions: true,
  },
  images: {
    domains: ['api.mapbox.com'],
  },
}

module.exports = nextConfig
```

#### Package Dependencies
```json
{
  "dependencies": {
    "next": "^14.2.0",
    "react": "^18.3.0",
    "react-dom": "^18.3.0",
    "typescript": "^5.4.0",
    "convex": "^1.6.0",
    "@stripe/stripe-js": "^2.1.0",
    "@stripe/react-stripe-js": "^2.3.0",
    "mapbox-gl": "^3.0.0",
    "react-map-gl": "^7.1.0",
    "@radix-ui/react-*": "latest",
    "tailwindcss": "^3.4.0",
    "lucide-react": "^0.300.0",
    "zod": "^3.22.0",
    "react-hook-form": "^7.48.0"
  }
}
```

### Backend Platform (Convex)

#### Schema Definition
```typescript
// convex/schema.ts
import { defineSchema, defineTable } from "convex/server";
import { v } from "convex/values";

export default defineSchema({
  users: defineTable({
    email: v.string(),
    name: v.string(),
    role: v.union(v.literal("consumer"), v.literal("provider")),
    stripeCustomerId: v.optional(v.string()),
    stripeAccountId: v.optional(v.string()), // For providers
    profile: v.object({
      phone: v.optional(v.string()),
      address: v.optional(v.string()),
      detroitZone: v.optional(v.string()),
    }),
  }).index("by_email", ["email"])
    .index("by_stripe_customer", ["stripeCustomerId"]),

  listings: defineTable({
    providerId: v.id("users"),
    title: v.string(),
    description: v.string(),
    category: v.union(
      v.literal("food_delivery"),
      v.literal("courier"),
      v.literal("aerial_imaging"),
      v.literal("site_mapping")
    ),
    price: v.object({
      base: v.number(),
      perMile: v.optional(v.number()),
    }),
    serviceArea: v.object({
      center: v.object({ 
        lat: v.number(), 
        lng: v.number() 
      }),
      radiusMiles: v.number(),
    }),
    availability: v.array(v.object({
      dayOfWeek: v.number(),
      startTime: v.string(),
      endTime: v.string(),
    })),
    active: v.boolean(),
  }).index("by_provider", ["providerId"])
    .index("by_category", ["category"])
    .searchIndex("search_listings", {
      searchField: "description",
      filterFields: ["category", "active"]
    }),

  bookings: defineTable({
    consumerId: v.id("users"),
    providerId: v.id("users"),
    listingId: v.id("listings"),
    status: v.union(
      v.literal("pending"),
      v.literal("confirmed"),
      v.literal("in_progress"),
      v.literal("completed"),
      v.literal("cancelled")
    ),
    scheduledAt: v.number(),
    location: v.object({
      pickup: v.optional(v.object({
        address: v.string(),
        coords: v.object({ lat: v.number(), lng: v.number() })
      })),
      dropoff: v.object({
        address: v.string(),
        coords: v.object({ lat: v.number(), lng: v.number() })
      })
    }),
    payment: v.object({
      amount: v.number(),
      stripePaymentIntentId: v.string(),
      status: v.string(),
    }),
    tracking: v.optional(v.object({
      currentLocation: v.object({ 
        lat: v.number(), 
        lng: v.number() 
      }),
      eta: v.number(),
    })),
  }).index("by_consumer", ["consumerId"])
    .index("by_provider", ["providerId"])
    .index("by_status", ["status"]),

  messages: defineTable({
    bookingId: v.id("bookings"),
    senderId: v.id("users"),
    content: v.string(),
    timestamp: v.number(),
  }).index("by_booking", ["bookingId"]),
});
```

#### Core Convex Functions
```typescript
// convex/bookings.ts
import { mutation, query, action } from "./_generated/server";
import { v } from "convex/values";
import { api } from "./_generated/api";

export const createBooking = mutation({
  args: {
    listingId: v.id("listings"),
    scheduledAt: v.number(),
    location: v.object({
      dropoff: v.object({
        address: v.string(),
        coords: v.object({ lat: v.number(), lng: v.number() })
      })
    }),
  },
  handler: async (ctx, args) => {
    const identity = await ctx.auth.getUserIdentity();
    if (!identity) throw new Error("Not authenticated");
    
    const listing = await ctx.db.get(args.listingId);
    if (!listing) throw new Error("Listing not found");
    
    // Calculate price based on distance
    const price = calculatePrice(listing, args.location);
    
    // Create booking
    const bookingId = await ctx.db.insert("bookings", {
      consumerId: identity.subject,
      providerId: listing.providerId,
      listingId: args.listingId,
      status: "pending",
      scheduledAt: args.scheduledAt,
      location: args.location,
      payment: {
        amount: price,
        stripePaymentIntentId: "", // Will be set after Stripe action
        status: "pending",
      },
    });
    
    // Trigger Stripe payment creation
    await ctx.scheduler.runAfter(0, api.stripe.createPaymentIntent, {
      bookingId,
      amount: price,
    });
    
    return bookingId;
  },
});

// Real-time subscription for tracking
export const trackBooking = query({
  args: { bookingId: v.id("bookings") },
  handler: async (ctx, args) => {
    const booking = await ctx.db.get(args.bookingId);
    if (!booking) return null;
    
    return {
      status: booking.status,
      tracking: booking.tracking,
      eta: booking.tracking?.eta,
    };
  },
});

// Update tracking location (called by provider)
export const updateTracking = mutation({
  args: {
    bookingId: v.id("bookings"),
    location: v.object({
      lat: v.number(),
      lng: v.number(),
    }),
  },
  handler: async (ctx, args) => {
    const identity = await ctx.auth.getUserIdentity();
    const booking = await ctx.db.get(args.bookingId);
    
    if (booking?.providerId !== identity?.subject) {
      throw new Error("Unauthorized");
    }
    
    await ctx.db.patch(args.bookingId, {
      tracking: {
        currentLocation: args.location,
        eta: calculateETA(args.location, booking.location.dropoff.coords),
      },
    });
  },
});
```

### Payment Integration (Stripe)

#### Stripe Configuration
```typescript
// convex/stripe.ts
import { action } from "./_generated/server";
import { v } from "convex/values";
import Stripe from "stripe";

const stripe = new Stripe(process.env.STRIPE_SECRET_KEY!, {
  apiVersion: "2023-10-16",
});

export const createPaymentIntent = action({
  args: {
    bookingId: v.id("bookings"),
    amount: v.number(),
  },
  handler: async (ctx, args) => {
    const booking = await ctx.runQuery(api.bookings.get, {
      bookingId: args.bookingId,
    });
    
    const paymentIntent = await stripe.paymentIntents.create({
      amount: Math.round(args.amount * 100),
      currency: "usd",
      metadata: {
        bookingId: args.bookingId,
      },
      automatic_payment_methods: {
        enabled: true,
      },
    });
    
    // Update booking with payment intent ID
    await ctx.runMutation(api.bookings.updatePayment, {
      bookingId: args.bookingId,
      paymentIntentId: paymentIntent.id,
    });
    
    return paymentIntent.client_secret;
  },
});

// Webhook handler
export const handleStripeWebhook = action({
  args: {
    signature: v.string(),
    payload: v.string(),
  },
  handler: async (ctx, args) => {
    const event = stripe.webhooks.constructEvent(
      args.payload,
      args.signature,
      process.env.STRIPE_WEBHOOK_SECRET!
    );
    
    switch (event.type) {
      case "payment_intent.succeeded":
        await ctx.runMutation(api.bookings.confirmPayment, {
          paymentIntentId: event.data.object.id,
        });
        break;
    }
  },
});
```

#### Payment Component
```typescript
// components/CheckoutForm.tsx
import { Elements, PaymentElement, useStripe, useElements } from "@stripe/react-stripe-js";
import { loadStripe } from "@stripe/stripe-js";

const stripePromise = loadStripe(process.env.NEXT_PUBLIC_STRIPE_KEY!);

export function CheckoutForm({ clientSecret }: { clientSecret: string }) {
  const stripe = useStripe();
  const elements = useElements();
  
  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    if (!stripe || !elements) return;
    
    const { error } = await stripe.confirmPayment({
      elements,
      confirmParams: {
        return_url: `${window.location.origin}/booking-confirmed`,
      },
    });
    
    if (error) {
      console.error(error);
    }
  };
  
  return (
    <form onSubmit={handleSubmit}>
      <PaymentElement />
      <button 
        type="submit" 
        disabled={!stripe}
        className="mt-4 w-full bg-red-600 text-white py-2 rounded"
      >
        Pay Now
      </button>
    </form>
  );
}
```

### Mapping Integration (Mapbox)

#### Map Component
```typescript
// components/ServiceMap.tsx
import Map, { Marker, Source, Layer } from 'react-map-gl';
import 'mapbox-gl/dist/mapbox-gl.css';

const DETROIT_CENTER = {
  latitude: 42.3314,
  longitude: -83.0458,
  zoom: 11
};

export function ServiceMap({ 
  listings, 
  selectedListing,
  userLocation 
}: ServiceMapProps) {
  return (
    <Map
      mapboxAccessToken={process.env.NEXT_PUBLIC_MAPBOX_TOKEN}
      initialViewState={DETROIT_CENTER}
      style={{ width: '100%', height: '400px' }}
      mapStyle="mapbox://styles/mapbox/streets-v12"
    >
      {/* Service area circles */}
      {listings.map(listing => (
        <Source
          key={listing._id}
          type="geojson"
          data={{
            type: "Feature",
            geometry: {
              type: "Point",
              coordinates: [
                listing.serviceArea.center.lng,
                listing.serviceArea.center.lat
              ]
            }
          }}
        >
          <Layer
            id={`circle-${listing._id}`}
            type="circle"
            paint={{
              'circle-radius': listing.serviceArea.radiusMiles * 5,
              'circle-color': '#BD1B04',
              'circle-opacity': 0.2
            }}
          />
        </Source>
      ))}
      
      {/* User location marker */}
      {userLocation && (
        <Marker
          latitude={userLocation.lat}
          longitude={userLocation.lng}
          color="#4CAF50"
        />
      )}
    </Map>
  );
}
```

### Real-time Features

#### Live Chat Implementation
```typescript
// components/BookingChat.tsx
import { useQuery, useMutation } from "convex/react";
import { api } from "@/convex/_generated/api";
import { useState } from "react";

export function BookingChat({ bookingId }: { bookingId: Id<"bookings"> }) {
  const messages = useQuery(api.messages.list, { bookingId });
  const sendMessage = useMutation(api.messages.send);
  const [newMessage, setNewMessage] = useState("");
  
  const handleSend = async () => {
    await sendMessage({
      bookingId,
      content: newMessage,
    });
    setNewMessage("");
  };
  
  return (
    <div className="flex flex-col h-96">
      <div className="flex-1 overflow-y-auto p-4">
        {messages?.map(msg => (
          <div key={msg._id} className="mb-2">
            <span className="font-bold">{msg.senderName}: </span>
            <span>{msg.content}</span>
          </div>
        ))}
      </div>
      <div className="border-t p-4 flex gap-2">
        <input
          value={newMessage}
          onChange={(e) => setNewMessage(e.target.value)}
          className="flex-1 border rounded px-2"
          placeholder="Type a message..."
        />
        <button 
          onClick={handleSend}
          className="bg-blue-500 text-white px-4 py-2 rounded"
        >
          Send
        </button>
      </div>
    </div>
  );
}
```

## Development Timeline (90 Minutes)

### First 30 Minutes: Foundation
```bash
# 1. Project Setup (5 min)
npx create-next-app@latest skymarket-dev --typescript --tailwind --app
cd skymarket-dev
npm install convex

# 2. Convex Setup (5 min)
npx convex dev
# Creates convex/ folder and connects to cloud

# 3. Auth Implementation (10 min)
# Use Cursor to generate auth components
# Prompt: "Create login and signup pages with Convex Auth"

# 4. Database Schema (10 min)
# Copy schema.ts to convex/
# Run npx convex dev to sync
```

### Next 30 Minutes: Core Features
```bash
# 1. Stripe Setup (10 min)
npm install @stripe/stripe-js @stripe/react-stripe-js stripe
# Add Stripe keys to .env.local
# Create payment intent action

# 2. Mapbox Integration (10 min)
npm install mapbox-gl react-map-gl
# Create ServiceMap component
# Add to listing pages

# 3. CRUD Operations (10 min)
# Generate with Cursor:
# "Create functions for listing CRUD in convex/listings.ts"
# "Create components for listing forms"
```

### Final 30 Minutes: Advanced Features
```bash
# 1. Real-time Tracking (10 min)
# Create tracking subscription
# Add location update mutation
# Build tracking UI component

# 2. Chat System (10 min)
# Create messages table and functions
# Build chat component
# Add to booking details page

# 3. Deployment (10 min)
# Push to GitHub
# Deploy to Vercel
# Configure environment variables
# Test production build
```

## Environment Configuration

### Development Setup
```bash
# .env.local
NEXT_PUBLIC_CONVEX_URL=https://your-project.convex.cloud
CONVEX_DEPLOY_KEY=your-deploy-key
NEXT_PUBLIC_STRIPE_KEY=pk_test_...
STRIPE_SECRET_KEY=sk_test_...
STRIPE_WEBHOOK_SECRET=whsec_...
NEXT_PUBLIC_MAPBOX_TOKEN=pk_...
RESEND_API_KEY=re_...
```

### Cursor Prompts for Rapid Development
```typescript
// Effective Cursor prompts:

"Create a Next.js app router page for browsing drone service listings with search and category filters"

"Add Convex mutation to create a booking with Stripe payment intent"

"Create a Mapbox component showing service areas as circles on Detroit map"

"Build real-time chat using Convex subscriptions for booking messages"

"Add TypeScript types for all Convex functions and ensure strict mode"
```

## Testing & Validation

### Key Test Scenarios
```typescript
// Test booking flow
describe('Booking Flow', () => {
  it('creates booking with payment', async () => {
    // 1. Select listing
    // 2. Choose date/time
    // 3. Enter delivery address
    // 4. Process payment
    // 5. Verify booking created
  });
  
  it('shows real-time tracking', async () => {
    // 1. Create booking
    // 2. Update provider location
    // 3. Verify consumer sees update
  });
});
```

## Performance Optimizations

### Convex Query Optimization
```typescript
// Use indexes for common queries
.index("by_status_and_date", ["status", "scheduledAt"])

// Paginate large result sets
export const listBookings = query({
  args: { 
    limit: v.number(),
    cursor: v.optional(v.string())
  },
  handler: async (ctx, args) => {
    return await ctx.db
      .query("bookings")
      .order("desc")
      .paginate({ 
        numItems: args.limit,
        cursor: args.cursor 
      });
  },
});
```

## Estimated Costs

### Development Phase (Hackathon)
- **Cursor IDE**: Free trial
- **Convex**: Free tier (1M function calls/month)
- **Stripe**: Test mode (free)
- **Mapbox**: Free tier (50k loads/month)
- **Vercel**: Free tier
- **Total**: $0

### Production Ready (Post-Hackathon)
- **Cursor IDE**: $20/month
- **Convex**: Free tier sufficient for < 1000 users
- **Stripe**: 2.9% + $0.30 per transaction
- **Mapbox**: Free tier sufficient
- **Vercel**: Free tier sufficient
- **Total**: $20/month + transaction fees

---

## Conclusion

The Developer Track delivers a production-ready marketplace in just 90 minutes by leveraging Cursor's AI assistance and Convex's integrated backend. This implementation includes all essential marketplace features - payments, maps, real-time tracking, and chat - providing a solid foundation that the Expert Track can enhance with AI and advanced analytics.

---

*This document serves as the complete technical guide for the Developer Track implementation of SkyMarket.*